<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kiá»ƒm Tra Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style/giaodienlambai.css">
  
</head>
<body>
  <div class="container">
    <div id="Traloi"></div>

  <div id="controlBtns">
    <button id="nopbai">Ná»™p bÃ i</button>
   
  </div>

  <div id="ketqua" style="margin-top:20px; padding:10px; background:#fff3cd; border:1px solid #ffeeba; border-radius:8px; display:none;">
  <h3>ğŸ“‹ Káº¿t quáº£ kiá»ƒm tra:</h3>
  <div id="noidungketqua"></div>
  </div>

  <script>
// ğŸ“¦ Láº¥y dá»¯ liá»‡u tá»« ngÃ¢n hÃ ng Ä‘á» thi
const allQuestions = JSON.parse(localStorage.getItem("cauhoi")) || [];

// ğŸ§® XÃ¡c Ä‘á»‹nh sá»‘ cÃ¢u
if (allQuestions.length === 0) {
  alert("âŒ Hiá»‡n chÆ°a cÃ³ cÃ¢u há»i trong ngÃ¢n hÃ ng Ä‘á»!");
  window.location.href = "them.html";
}

let numQuestions = 8;
const mode = localStorage.getItem("chedo");

if (mode === "gioihan") {
  numQuestions = parseInt(localStorage.getItem("gt") || "8");
  if (numQuestions > allQuestions.length) {
    alert("âš ï¸ NgÃ¢n hÃ ng Ä‘á» khÃ´ng Ä‘á»§ sá»‘ cÃ¢u. Vui lÃ²ng thÃªm thÃªm cÃ¢u há»i.");
    window.location.href = "option.html";
  }
}



// ğŸ¯ Random sá»‘ lÆ°á»£ng cÃ¢u há»i theo yÃªu cáº§u
const selectedQuestions = allQuestions
  .sort(() => Math.random() - 0.5)
  .slice(0, numQuestions);

const userAnswers = new Array(numQuestions).fill(null);
const markFlags = new Array(numQuestions).fill(false);


  const Traloi = document.getElementById("Traloi");

for (let i = 0; i < numQuestions; i++) {
  const q = selectedQuestions[i];
  const div = document.createElement("div");
  div.className = "ChonAns";
  div.innerHTML = `<p><strong>CÃ¢u ${i + 1}:</strong> ${q.question}</p>`;

  // ğŸ”– NÃºt Ä‘Ã¡nh dáº¥u
  const markBtn = document.createElement("button");
  markBtn.textContent = "ğŸ”– ÄÃ¡nh dáº¥u";
  markBtn.onclick = () => {
    markFlags[i] = !markFlags[i];
    markBtn.style.backgroundColor = markFlags[i] ? "#ffe599" : "";
    markBtn.style.fontWeight = markFlags[i] ? "bold" : "normal";
  };
  div.appendChild(markBtn);

  // ğŸ¯ NÃºt chá»n Ä‘Ã¡p Ã¡n A-D
  ["A", "B", "C", "D"].forEach(label => {
    const btn = document.createElement("button");
    btn.textContent = `${label}: ${q.answers[label]}`;
    btn.onclick = () => {
      userAnswers[i] = label;
      const siblings = div.querySelectorAll("button:not(:first-child)");
      siblings.forEach(b => {
        b.style.backgroundColor = "";
        b.style.fontWeight = "normal";
      });
      btn.style.backgroundColor = "#d0f0c0";
      btn.style.fontWeight = "bold";
    };
    div.appendChild(btn);
  });

  Traloi.appendChild(div);
}



  // â³ Äáº¿m ngÆ°á»£c thá»i gian (5 phÃºt)
  if (mode === "gioihan") {
    const timerDiv = document.createElement("div");
timerDiv.id = "timer"; // Ä‘áº·t ID Ä‘á»ƒ cÃ³ thá»ƒ áº©n sau
timerDiv.style = "font-weight:bold; color:red; margin-bottom:10px";
document.body.insertBefore(timerDiv, document.body.firstChild);

let timeLeft = selectedQuestions.reduce((sum, q) => sum + q.time, 0);


const timer = setInterval(() => {
  const min = Math.floor(timeLeft / 60);
  const sec = timeLeft % 60;
  timerDiv.textContent = `ğŸ•’ Thá»i gian cÃ²n láº¡i: ${min}:${sec < 10 ? "0" : ""}${sec}`;
  
  if (--timeLeft < 0) {
    clearInterval(timer);
    document.getElementById("timer").remove();
    nopBai(true); // gá»i ná»™p bÃ i, khÃ´ng cáº£nh bÃ¡o
  }
}, 1000);

  }

  // ğŸ“‹ NÃºt Ná»™p bÃ i
  document.getElementById("nopbai").onclick = () => nopBai(false);

  function nopBai(isAuto = false) {
  if (!isAuto) {
    const unanswered = userAnswers
      .map((ans, i) => ans === null ? `CÃ¢u ${i + 1}` : null)
      .filter(x => x !== null);

    if (unanswered.length) {
      const confirmSubmit = confirm(`âš ï¸ Báº¡n chÆ°a tráº£ lá»i cÃ¡c cÃ¢u: ${unanswered.join(", ")}.\nVáº«n muá»‘n ná»™p bÃ i?`);
      if (!confirmSubmit) return;
    }
  }

  document.getElementById("timer")?.remove();

  let score = 0;
  let wrongList = [];

  for (let i = 0; i < numQuestions; i++) {
    const q = selectedQuestions[i];
    const correct = q.correct; // "A" / "B" / "C" / "D"
    const user = userAnswers[i];

    if (user === correct) {
      score++;
    } else {
      wrongList.push(
        `<li>CÃ¢u ${i + 1}: Báº¡n chá»n <strong>${user ?? "-"}</strong>, Ä‘Ãºng lÃ  <strong>${correct}</strong></li>`
      );
    }
  }

  const numMarked = markFlags.filter(x => x).length;
  const ketquaDiv = document.getElementById("ketqua");
  const ndkq = document.getElementById("noidungketqua");

  ndkq.innerHTML = `
    <p>ğŸ‰ Báº¡n Ä‘Ãºng <strong>${score}/${numQuestions}</strong> cÃ¢u!</p>
    <p>ğŸ”– ÄÃ£ Ä‘Ã¡nh dáº¥u <strong>${numMarked}</strong> cÃ¢u</p>
    ${wrongList.length ? `<p>âŒ CÃ¡c cÃ¢u sai:</p><ul>${wrongList.join("")}</ul>` : `<p>âœ… Báº¡n Ä‘Ã£ lÃ m Ä‘Ãºng táº¥t cáº£ cÃ¡c cÃ¢u!</p>`}
    <br>
    <button onclick="window.location.href='menu.html'" style="padding: 8px 14px; margin-top: 10px;">ğŸ  Quay vá» trang chá»§</button>
  `;

  ketquaDiv.style.display = "block";
  ketquaDiv.scrollIntoView({ behavior: "smooth" });
}



</script>



</body>
</html>